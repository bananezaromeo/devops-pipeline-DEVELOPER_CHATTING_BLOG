const socket = io('http://localhost:5000');let selectedUser = null;let currentUserId = localStorage.getItem('userId'); // must be set after login// Join own roomif (currentUserId) socket.emit("join", currentUserId);// Load users(async function loadUsers() {    const users = await request("/users");    const list = document.getElementById("userList");    list.innerHTML = "";    users.forEach(u => {        const div = document.createElement("div");        div.className = "user";        div.innerText = u.username;        div.onclick = () => selectUser(u);        list.appendChild(div);    });})();// Select user and load chat historyasync function selectUser(user) {    selectedUser = user;    // Optional: join the selected user's room (for real-time updates)    socket.emit("join", user._id);    const msgs = await request(`/messages/${user._id}`);    const box = document.getElementById("messages");    box.innerHTML = "";    msgs.forEach(m => {        const decrypted = CryptoJS.AES.decrypt(m.content, "secret123").toString(CryptoJS.enc.Utf8);        const div = document.createElement("div");        div.innerText = decrypted;        box.appendChild(div);    });}// Send messageasync function sendMessage() {    const text = document.getElementById("messageInput").value;    if (!text || !selectedUser) return;    const encrypted = CryptoJS.AES.encrypt(text, "secret123").toString();    // Save to backend DB    await request("/messages", "POST", {        receiverId: selectedUser._id,        content: encrypted    });    // Emit via Socket.IO for real-time    socket.emit("sendMessage", {        senderId: currentUserId,        receiverId: selectedUser._id,        content: encrypted    });    document.getElementById("messageInput").value = "";}// Listen for incoming messagessocket.on("receiveMessage", (msg) => {    if (!selectedUser) return;    if (msg.sender === selectedUser._id || msg.receiver === selectedUser._id) {        const decrypted = CryptoJS.AES.decrypt(msg.content, "secret123").toString(CryptoJS.enc.Utf8);        const div = document.createElement("div");        div.innerText = decrypted;        document.getElementById("messages").appendChild(div);    }});